# Flibusta Telegram Bot - –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

## üìã EXECUTIVE SUMMARY

**–ü—Ä–æ–µ–∫—Ç**: Telegram-–±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–Ω–∏–≥ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Flibusta  
**–Ø–∑—ã–∫**: Python 3.11  
**–§—Ä–µ–π–º–≤–æ—Ä–∫**: python-telegram-bot  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: MariaDB 12.0 (—Ä–æ–¥–Ω–∞—è –ë–î –§–ª–∏–±—É—Å—Ç—ã) + SQLite (–ª–æ–≥–∏/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)  
**–î–µ–ø–ª–æ–π**: Docker + docker-compose  
**–•–æ—Å—Ç–∏–Ω–≥**: VPS (1 CPU / 1 GB RAM)

---

## üéØ 1. –û–ë–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### 1.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Telegram Bot API                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Python Application                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Handlers   ‚îÇ  ‚îÇ   Database   ‚îÇ  ‚îÇ  Flibusta ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   (–∫–æ–º–∞–Ω–¥—ã,  ‚îÇ‚óÑ‚îÄ‚î§   Layer      ‚îÇ‚óÑ‚îÄ‚î§  Client   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   callback,   ‚îÇ  ‚îÇ   (MariaDB + ‚îÇ  ‚îÇ  (HTTP)   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   —Å–æ–æ–±—â–µ–Ω–∏—è) ‚îÇ  ‚îÇ    SQLite)   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚ñº                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MariaDB       ‚îÇ    ‚îÇ   SQLite DBs     ‚îÇ
‚îÇ  (–∫–Ω–∏–≥–∏,–∞–≤—Ç–æ—Ä—ã, ‚îÇ    ‚îÇ  (–ª–æ–≥–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏‚îÇ
‚îÇ   –∂–∞–Ω—Ä—ã,—Å–µ—Ä–∏–∏)  ‚îÇ    ‚îÇ   –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 1.2 –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏

| –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã |
|--------|-----------|----------------|
| **Core** | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è | `main.py` |
| **Handlers** | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥/—Å–æ–±—ã—Ç–∏–π | `handlers_*.py` |
| **Database** | –†–∞–±–æ—Ç–∞ —Å –ë–î | `database.py` |
| **Context** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º | `context.py` |
| **Admin** | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | `admin.py` |
| **Logger** | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | `logger.py` |
| **Utils** | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ | `utils.py`, `handlers_utils.py` |
| **Client** | HTTP-–∫–ª–∏–µ–Ω—Ç Flibusta | `flibusta_client.py` |

---

## üèóÔ∏è 2. –î–ï–¢–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–û –°–õ–û–Ø–ú

### 2.1 PRESENTATION LAYER (–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏)

#### 2.1.1 –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã (`handlers_basic.py`)
```python
–ö–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
‚îú‚îÄ‚îÄ /start - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ /help - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –ø–æ–∏—Å–∫–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–∞–º
‚îú‚îÄ‚îÄ /about - –û –±–æ—Ç–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îú‚îÄ‚îÄ /news - –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ /genres - –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤
‚îú‚îÄ‚îÄ /pop - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏ –∏ –Ω–æ–≤–∏–Ω–∫–∏
‚îú‚îÄ‚îÄ /set - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∏—Å–∫–∞
‚îî‚îÄ‚îÄ /donate - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (Telegram Stars)
```

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
- `start_cmd()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `donate_cmd()` - —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–æ–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã
- `about_cmd()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ `DB_BOOKS.get_library_stats()`

#### 2.1.2 –ü–æ–∏—Å–∫–æ–≤—ã–π –¥–≤–∏–∂–æ–∫ (`handlers_search.py`)
```python
–¢–∏–ø—ã –ø–æ–∏—Å–∫–∞:
‚îú‚îÄ‚îÄ handle_search_books() - –ü–æ–∏—Å–∫ –∫–Ω–∏–≥
‚îÇ   ‚îú‚îÄ‚îÄ –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä, –∂–∞–Ω—Ä, —Å–µ—Ä–∏—è, –≥–æ–¥)
‚îÇ   ‚îú‚îÄ‚îÄ –ü–æ–∏—Å–∫ –ø–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º –∫–Ω–∏–≥
‚îÇ   ‚îî‚îÄ‚îÄ –ü–æ–∏—Å–∫ –ø–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º –∞–≤—Ç–æ—Ä–æ–≤
‚îú‚îÄ‚îÄ handle_search_series() - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–µ—Ä–∏—è–º
‚îî‚îÄ‚îÄ handle_search_authors() - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–≤—Ç–æ—Ä–∞–º
```

**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**:
```python
async def handle_search_books(update, context):
    processing_msg = await message.reply_text("‚è∞ –ò—â—É –∫–Ω–∏–≥–∏...")
    asyncio.create_task(
        async_search_books(context, query_text, processing_msg, user)
    )
```

**–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º**:
- `handle_books_page_change()` - –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–µ –∫–Ω–∏–≥
- `handle_series_page_change()` - –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–µ —Å–µ—Ä–∏–π
- `handle_authors_page_change()` - –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–æ–≤

#### 2.1.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (`handlers_settings.py`)
```python
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
‚îú‚îÄ‚îÄ MaxBooks (20/40) - –∫–Ω–∏–≥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
‚îú‚îÄ‚îÄ Lang (ru/en/etc) - —è–∑—ã–∫ –∫–Ω–∏–≥
‚îú‚îÄ‚îÄ BookFormat (fb2/epub/mobi) - —Ñ–æ—Ä–º–∞—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ SearchType (books/series/authors) - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ Rating (0-5) - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
‚îú‚îÄ‚îÄ BookSize (less800/more800) - —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
‚îî‚îÄ‚îÄ SearchArea (b/ba/aa) - –æ–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞
```

#### 2.1.4 –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–∞—Ö (`handlers_info.py`)
```python
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–∫–Ω–∞:
‚îú‚îÄ‚îÄ handle_book_info() - –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è + –æ–±–ª–æ–∂–∫–∞
‚îú‚îÄ‚îÄ handle_book_details() - –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ handle_author_info() - –±–∏–æ–≥—Ä–∞—Ñ–∏—è –∞–≤—Ç–æ—Ä–∞ + —Ñ–æ—Ç–æ
‚îú‚îÄ‚îÄ handle_book_reviews() - –æ—Ç–∑—ã–≤—ã —á–∏—Ç–∞—Ç–µ–ª–µ–π
‚îî‚îÄ‚îÄ handle_close_info() - –∑–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–æ–Ω
```

#### 2.1.5 –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã (`handlers_group.py`)
```python
–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –≤ –≥—Ä—É–ø–ø–∞—Ö:
‚îú‚îÄ‚îÄ –û–±—Ä–∞—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ @botusername
‚îú‚îÄ‚îÄ –û–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–∏—Å–∫–∞ (bot_data)
‚îú‚îÄ‚îÄ –ü–æ–∫–∞–∑ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
‚îî‚îÄ‚îÄ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
```

#### 2.1.6 –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (`admin.py`)
```python
–ê–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
‚îú‚îÄ‚îÄ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –ø–∞—Ä–æ–ª—é
‚îú‚îÄ‚îÄ –°–µ—Å—Å–∏–∏ —Å —Ç–∞–π–º–∞—É—Ç–æ–º (30 –º–∏–Ω)
‚îú‚îÄ‚îÄ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
‚îú‚îÄ‚îÄ –õ–æ–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
‚îî‚îÄ‚îÄ –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```

### 2.2 BUSINESS LOGIC LAYER

#### 2.2.1 –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (`context.py`)
```python
class ContextManager:
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º:
    ‚îú‚îÄ‚îÄ user_data (–ª–∏—á–Ω—ã–µ —á–∞—Ç—ã) - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏—Å—Ç–æ—Ä–∏—è
    ‚îú‚îÄ‚îÄ bot_data (–≥—Ä—É–ø–ø—ã) - –ø–æ–∏—Å–∫–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    ‚îú‚îÄ‚îÄ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π (1 —á–∞—Å)
    ‚îî‚îÄ‚îÄ –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ –ë–î
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```python
USER_PARAMS - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
LAST_ACTIVITY - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
PAGES_OF_BOOKS/SERIES/AUTHORS - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
CURRENT_SERIES_NAME/AUTHOR_ID - –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
LAST_BOT_MESSAGE_ID - –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
```

#### 2.2.2 –ö–ª–∏–µ–Ω—Ç Flibusta (`flibusta_client.py`)
```python
class FlibustaClient:
    –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
    ‚îú‚îÄ‚îÄ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–∞–π—Ç–µ
    ‚îú‚îÄ‚îÄ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–Ω–∏–≥ (auth/non-auth)
    ‚îú‚îÄ‚îÄ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ–±–ª–æ–∂–µ–∫ (BeautifulSoup)
    ‚îú‚îÄ‚îÄ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL (–∫–Ω–∏–≥–∏, –∞–≤—Ç–æ—Ä—ã, –∂–∞–Ω—Ä—ã)
    ‚îî‚îÄ‚îÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ (aiohttp)
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è**:
1. –ü–æ–ø—ã—Ç–∫–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
2. –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ - —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
3. –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ - –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ tmpfiles.org

### 2.3 DATA ACCESS LAYER (`database.py`)

#### 2.3.1 DatabaseBooks (MariaDB)
```python
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –§–ª–∏–±—É—Å—Ç—ã:
‚îú‚îÄ‚îÄ libbook - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–Ω–∏–≥
‚îú‚îÄ‚îÄ libavtor / libavtorname - –∞–≤—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ libseq / libseqname - —Å–µ—Ä–∏–∏
‚îú‚îÄ‚îÄ libgenre / libgenrelist - –∂–∞–Ω—Ä—ã
‚îú‚îÄ‚îÄ libbannotations - –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∫–Ω–∏–≥
‚îú‚îÄ‚îÄ libaannotations - –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∞–≤—Ç–æ—Ä–æ–≤
‚îú‚îÄ‚îÄ librate - —Ä–µ–π—Ç–∏–Ω–≥–∏
‚îú‚îÄ‚îÄ libreviews - –æ—Ç–∑—ã–≤—ã
‚îî‚îÄ‚îÄ libbook_fts - –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**:
```sql
-- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
SELECT ... FROM libbook_fts WHERE MATCH(FT) AGAINST(query IN BOOLEAN MODE)

-- –ü–æ–∏—Å–∫ –ø–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º
SELECT ... FROM libbannotations WHERE MATCH(Body) AGAINST(query)

-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏
SELECT ... FROM (–ø–æ–¥–∑–∞–ø—Ä–æ—Å —Å –ø–æ–¥—Å—á—ë—Ç–æ–º recs, reviews, rates)

-- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–µ—Ä–∏—è–º
SELECT SeriesTitle, COUNT(*) FROM books GROUP BY SeriesTitle
```

**–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- `_class_cached_langs` - —è–∑—ã–∫–∏
- `_class_cached_parent_genres` - —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∂–∞–Ω—Ä—ã
- `_class_cached_genres` - –¥–æ—á–µ—Ä–Ω–∏–µ –∂–∞–Ω—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- `_class_stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

#### 2.3.2 DatabaseLogs (SQLite)
```python
–¢–∞–±–ª–∏—Ü–∞ UserLog:
‚îú‚îÄ‚îÄ Timestamp - –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è
‚îú‚îÄ‚îÄ UserID - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ UserName - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ Action - —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è
‚îî‚îÄ‚îÄ Detail - –¥–µ—Ç–∞–ª–∏ –¥–µ–π—Å—Ç–≤–∏—è

–¢–∞–±–ª–∏—Ü–∞ UserPayment:
‚îú‚îÄ‚îÄ PaymentID - ID –ø–ª–∞—Ç–µ–∂–∞ (Telegram Stars)
‚îú‚îÄ‚îÄ UserID - –ø–ª–∞—Ç–µ–ª—å—â–∏–∫
‚îú‚îÄ‚îÄ Amount - —Å—É–º–º–∞
‚îú‚îÄ‚îÄ PaymentStatus - —Å—Ç–∞—Ç—É—Å
‚îî‚îÄ‚îÄ RefundInfo - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–æ–∑–≤—Ä–∞—Ç–∞—Ö
```

**–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**:
```python
get_user_stats_summary() - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
get_daily_user_stats(days) - –ø–æ –¥–Ω—è–º
get_top_searches(limit) - –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
get_top_downloads(limit) - –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
get_payment_stats(days) - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–Ω–∞—Ç–æ–≤
```

#### 2.3.3 DatabaseSettings (SQLite)
```python
–¢–∞–±–ª–∏—Ü–∞ UserSettings:
‚îú‚îÄ‚îÄ User_ID - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (PRIMARY KEY)
‚îú‚îÄ‚îÄ MaxBooks - –∫–Ω–∏–≥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (20/40)
‚îú‚îÄ‚îÄ Lang - —è–∑—ã–∫ –∫–Ω–∏–≥
‚îú‚îÄ‚îÄ BookFormat - —Ñ–æ—Ä–º–∞—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ SearchType - —Ç–∏–ø –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
‚îú‚îÄ‚îÄ Rating - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
‚îú‚îÄ‚îÄ BookSize - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞
‚îú‚îÄ‚îÄ SearchArea - –æ–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞
‚îú‚îÄ‚îÄ IsBlocked - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îî‚îÄ‚îÄ LastNewsDate - –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
```

### 2.4 UTILITY LAYER

#### 2.4.1 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (`logger.py`)
```python
class SingletonLogger:
    ‚îú‚îÄ‚îÄ –§–∞–π–ª–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–æ—Ç–∞—Ü–∏—è –ø–æ –¥–Ω—è–º, 60 –¥–Ω–µ–π)
    ‚îú‚îÄ‚îÄ –ë–î –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (UserLog)
    ‚îú‚îÄ‚îÄ log_user_action() - –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    ‚îú‚îÄ‚îÄ log_system_action() - —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
    ‚îî‚îÄ‚îÄ log_payment() - –ø–ª–∞—Ç–µ–∂–∏
```

#### 2.4.2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è (`health.py`)
```python
–°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
‚îú‚îÄ‚îÄ get_memory_usage() - –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ (MB)
‚îú‚îÄ‚îÄ get_system_stats() - CPU, –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã, –ø–æ—Ç–æ–∫–∏
‚îú‚îÄ‚îÄ cleanup_memory() - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (gc.collect)
‚îî‚îÄ‚îÄ cleanup_old_sessions() - –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
```

**Job Queue –∑–∞–¥–∞—á–∏**:
- `cleanup_old_sessions` - –∫–∞–∂–¥—ã–π —á–∞—Å (CLEANUP_INTERVAL=3600)

#### 2.4.3 –£—Ç–∏–ª–∏—Ç—ã (`utils.py`)
```python
–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
‚îú‚îÄ‚îÄ format_size() - —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (B/K/M/G)
‚îú‚îÄ‚îÄ format_book_info() - –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–Ω–∏–≥–∏
‚îú‚îÄ‚îÄ format_author_info() - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ—Ä–µ
‚îú‚îÄ‚îÄ clean_html_tags() - –æ—á–∏—Å—Ç–∫–∞ HTML –∏–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
‚îî‚îÄ‚îÄ truncate_text() - –æ–±—Ä–µ–∑–∫–∞ —Å —É—á—ë—Ç–æ–º —Å–∏–º–≤–æ–ª–æ–≤

–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏:
‚îú‚îÄ‚îÄ upload_to_tmpfiles() - –∑–∞–≥—Ä—É–∑–∫–∞ –±–æ–ª—å—à–∏—Ö –∫–Ω–∏–≥
‚îî‚îÄ‚îÄ load_bot_news() - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π

–ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã:
‚îú‚îÄ‚îÄ is_message_for_bot() - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è
‚îî‚îÄ‚îÄ extract_clean_query() - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
```

---

## üîç 3. –ü–û–ò–°–ö–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê

### 3.1 –¢–∏–ø—ã –ø–æ–∏—Å–∫–∞

#### 3.1.1 –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–∏—Å–∫ (SETTING_SEARCH_AREA_B)
```sql
–û–±–ª–∞—Å—Ç—å: –Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä—ã, –∂–∞–Ω—Ä—ã, —Å–µ—Ä–∏–∏, –≥–æ–¥
–ò–Ω–¥–µ–∫—Å: libbook_fts (fulltext –Ω–∞ CONCAT –ø–æ–ª—è—Ö)
–û–ø–µ—Ä–∞—Ç–æ—Ä—ã:
  + –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ
  - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
  * —á–∞—Å—Ç—å —Å–ª–æ–≤–∞
  () –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (OR)
  "" —Ñ—Ä–∞–∑–∞ —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º @N
```

#### 3.1.2 –ü–æ–∏—Å–∫ –ø–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º –∫–Ω–∏–≥ (SETTING_SEARCH_AREA_BA)
```sql
–û–±–ª–∞—Å—Ç—å: libbannotations.Body
–ò–Ω–¥–µ–∫—Å: FULLTEXT(Body)
–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–ª–æ–≤–∞: 3 —Å–∏–º–≤–æ–ª–∞
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –ø–æ–∏—Å–∫ –ø–æ —Å—é–∂–µ—Ç—É, —Ç–µ–º–∞—Ç–∏–∫–µ
```

#### 3.1.3 –ü–æ–∏—Å–∫ –ø–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º –∞–≤—Ç–æ—Ä–æ–≤ (SETTING_SEARCH_AREA_AA)
```sql
–û–±–ª–∞—Å—Ç—å: libaannotations.Body
–ò–Ω–¥–µ–∫—Å: FULLTEXT(Body)
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –±–∏–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ, –Ω–∞–≥—Ä–∞–¥—ã, –º–µ—Å—Ç–∞
```

### 3.2 –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞

```python
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   ‚îú‚îÄ‚îÄ user_params = get_user_params(context)
   ‚îú‚îÄ‚îÄ query_text - —Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞
   ‚îú‚îÄ‚îÄ lang - —Ñ–∏–ª—å—Ç—Ä –ø–æ —è–∑—ã–∫—É
   ‚îú‚îÄ‚îÄ size_limit - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞
   ‚îú‚îÄ‚îÄ rating_filter - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
   ‚îî‚îÄ‚îÄ search_area - –æ–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞

2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞
   ‚îú‚îÄ‚îÄ SELECT_SQL_QUERY[search_area] - –±–∞–∑–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
   ‚îú‚îÄ‚îÄ build_sql_where_ft() - WHERE —É—Å–ª–æ–≤–∏—è
   ‚îî‚îÄ‚îÄ MATCH ... AGAINST (query IN BOOLEAN MODE)

3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
   ‚îú‚îÄ‚îÄ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ ThreadPoolExecutor
   ‚îú‚îÄ‚îÄ –õ–∏–º–∏—Ç: MAX_BOOKS_SEARCH = 2000
   ‚îî‚îÄ‚îÄ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ Relevance DESC

4. –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞
   ‚îú‚îÄ‚îÄ –ü–∞–≥–∏–Ω–∞—Ü–∏—è (MaxBooks –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)
   ‚îú‚îÄ‚îÄ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (books/series/authors)
   ‚îî‚îÄ‚îÄ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
```

### 3.3 –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏ –Ω–æ–≤–∏–Ω–∫–∏

```python
–ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥—Å—á—ë—Ç–∞ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏:
‚îú‚îÄ‚îÄ librate - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫
‚îú‚îÄ‚îÄ librecs - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
‚îú‚îÄ‚îÄ libreviews - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤
‚îî‚îÄ‚îÄ –§–∏–ª—å—Ç—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (days_back: 7/30/999/0)

–ù–æ–≤–∏–Ω–∫–∏ (days_back=0):
  ORDER BY b.BookID DESC - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ ID
```

---

## üóÑÔ∏è 4. –°–•–ï–ú–ê –î–ê–ù–ù–´–•

### üóÑÔ∏è –°–¢–†–ê–¢–ï–ì–ò–Ø –†–ê–ë–û–¢–´ –° –ë–î FLIBUSTA

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü:
```
MariaDB (flibusta):
‚îú‚îÄ‚îÄ lib* (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã) - staging area –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ libbook
‚îÇ   ‚îú‚îÄ‚îÄ libavtor
‚îÇ   ‚îú‚îÄ‚îÄ libgenre
‚îÇ   ‚îî‚îÄ‚îÄ ... (–ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑ –±—ç–∫–∞–ø–æ–≤)
‚îÇ
‚îî‚îÄ‚îÄ cb_lib* (–∫–æ–ø–∏–∏ –¥–ª—è –±–æ—Ç–∞) - production tables
    ‚îú‚îÄ‚îÄ cb_libbook
    ‚îú‚îÄ‚îÄ cb_libavtor
    ‚îú‚îÄ‚îÄ cb_libgenre
    ‚îú‚îÄ‚îÄ cb_libbook_fts (–ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å)
    ‚îî‚îÄ‚îÄ ... (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–æ—Ç–æ–º)
```

#### –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î:
```bash
1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞ ‚Üí lib* —Ç–∞–±–ª–∏—Ü—ã
2. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ lib* —Ç–∞–±–ª–∏—Ü–∞—Ö
3. –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ libbook_fts
4. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ lib* ‚Üí cb_lib*
5. –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å cb_lib* –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞:

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç–∞—é—â–∏–π –±–æ—Ç
‚úÖ **–û—Ç–∫–∞—Ç** - –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä—ã–º cb_* –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
‚úÖ **Zero downtime** - –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 4.1 MariaDB (Flibusta)

```sql
-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
libbook (BookID PK, Title, Lang, Year, FileSize, Deleted)
  ‚îî‚îÄ INDEX libbook_fts (FULLTEXT –Ω–∞ FT)

libavtor (BookID FK, AvtorID FK)
libavtorname (AvtorID PK, LastName, FirstName, MiddleName)

libseq (BookID FK, SeqID FK, SeqNumb)
libseqname (SeqID PK, SeqName)

libgenre (BookID FK, GenreID FK)
libgenrelist (GenreID PK, GenreCode, GenreDesc, GenreMeta)

librate (BookId FK, Rate)
libreviews (BookID FK, Name, Time, Text)

libbannotations (BookID PK, Body TEXT)
  ‚îî‚îÄ FULLTEXT INDEX(Body)

libaannotations (AvtorId PK, title, Body TEXT)
  ‚îî‚îÄ FULLTEXT INDEX(Body)
```

### 4.2 SQLite (Settings)

```sql
CREATE TABLE UserSettings (
    User_ID INTEGER PRIMARY KEY,
    MaxBooks INTEGER DEFAULT 20,
    Lang VARCHAR(2) DEFAULT '',
    BookFormat VARCHAR(5) DEFAULT 'fb2',
    SearchType TEXT DEFAULT 'books',
    Rating TEXT DEFAULT '',
    BookSize TEXT DEFAULT '',
    SearchArea TEXT DEFAULT 'b',
    IsBlocked BOOLEAN DEFAULT FALSE,
    LastNewsDate VARCHAR(10) DEFAULT '2000-01-01'
);
```

### 4.3 SQLite (Logs)

```sql
CREATE TABLE UserLog (
    Timestamp VARCHAR(27) NOT NULL,
    UserID INTEGER NOT NULL,
    UserName VARCHAR(50),
    Action VARCHAR(50),
    Detail VARCHAR(255),
    PRIMARY KEY(Timestamp, UserID)
);
CREATE INDEX IXUserLog_UserID_Timestamp ON UserLog(UserID, Timestamp);

CREATE TABLE UserPayment (
    PaymentID VARCHAR(100) PRIMARY KEY,
    UserID INTEGER NOT NULL,
    Amount DECIMAL(15,2) NOT NULL,
    Currency VARCHAR(10) NOT NULL,
    PaymentDate DATETIME NOT NULL,
    PaymentStatus VARCHAR(20) NOT NULL,
    ...
);
```

---

## ‚öôÔ∏è 5. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò –î–ï–ü–õ–û–ô

### 5.1 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```bash
# Telegram Bot
BOT_TOKEN=<—Ç–æ–∫–µ–Ω>
TZ=Europe/Moscow
BOT_USERNAME=flibustabot

# MariaDB
DB_HOST=localhost
DB_PORT=3306
DB_NAME=flibusta
DB_USER=flibusta
DB_PASSWORD=<–ø–∞—Ä–æ–ª—å>

# Feedback
FEEDBACK_EMAIL=<email>
FEEDBACK_TELEGRAM=<—Å—Å—ã–ª–∫–∞>

# Admin
ADMIN_PASSWORD=<–ø–∞—Ä–æ–ª—å>

# Donations
DONATE_SOL=<–∞–¥—Ä–µ—Å>
DONATE_BTC=<–∞–¥—Ä–µ—Å>
...

# VPS
VPS_EXPIRY_DATE=2026-04-04
```

### 5.2 Docker Compose

```yaml
services:
  db:
    image: mariadb:12.0
    environment:
      - MYSQL_DATABASE=flibusta
      - MYSQL_USER=flibusta
    volumes:
      - mariadb_data:/var/lib/mysql
      - ./db_init:/docker-entrypoint-initdb.d:ro
      - ./config/my.cnf:/etc/mysql/conf.d/custom.cnf:ro
    
  bot:
    image: holyshithappens/flbst-bot-mdb
    depends_on:
      db: {condition: service_healthy}
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
```

### 5.3 MariaDB –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (my.cnf)

```ini
[mysqld]
character-set-server=utf8mb3
collation-server=utf8mb3_unicode_ci

# Full-text search
ft_min_word_len=3
innodb_ft_min_token_size=3

# –î–ª—è VPS (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã)
innodb-buffer-pool-size=384M
key-buffer-size=32M
max-connections=100
```

### 5.4 –°–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è

**deploy.sh** - –¥–µ–ø–ª–æ–π –Ω–∞ VPS:
```bash
-u, --update    # –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (pull + restart)
-n, --news      # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
-d, --db-init   # –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
(–±–µ–∑ –æ–ø—Ü–∏–π)     # –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π (build + push + deploy)
```

**deploy-local.sh** - –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
```bash
-u, --update    # –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
-d, --db-init   # –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
(–±–µ–∑ –æ–ø—Ü–∏–π)     # –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∏ –¥–µ–ø–ª–æ–π
```

---

## üîê 6. –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

### 6.1 –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```python
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã:
‚îú‚îÄ‚îÄ –ü–∞—Ä–æ–ª—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è ADMIN_PASSWORD
‚îú‚îÄ‚îÄ –°–µ—Å—Å–∏–∏ —Å —Ç–∞–π–º–∞—É—Ç–æ–º 30 –º–∏–Ω—É—Ç
‚îú‚îÄ‚îÄ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
‚îî‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ is_admin() –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–π—Å—Ç–≤–∏–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
‚îú‚îÄ‚îÄ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ admin_sessions
‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ IsBlocked –∏–∑ UserSettings
‚îî‚îÄ‚îÄ –ù–µ–ª—å–∑—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∞–¥–º–∏–Ω–æ–≤
```

### 6.2 –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

```python
–ü–æ–∏—Å–∫:
‚îú‚îÄ‚îÄ MAX_BOOKS_SEARCH = 2000
‚îú‚îÄ‚îÄ MAX_AUTHORS_SEARCH = 200
‚îú‚îÄ‚îÄ MAX_SERIES_SEARCH = 200

–ü–∞–º—è—Ç—å:
‚îú‚îÄ‚îÄ Docker limits: 256M (bot), 768M (db) –Ω–∞ VPS
‚îú‚îÄ‚îÄ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ 1 —á–∞—Å
‚îî‚îÄ‚îÄ gc.collect() –≤ cleanup_memory()

–¢–∞–π–º–∞—É—Ç—ã:
‚îú‚îÄ‚îÄ HTTP requests: 60 —Å–µ–∫—É–Ω–¥
‚îú‚îÄ‚îÄ Telegram API: 60 —Å–µ–∫—É–Ω–¥
‚îî‚îÄ‚îÄ –°–µ—Å—Å–∏—è –ø–æ–∏—Å–∫–∞: 1 —á–∞—Å (CLEANUP_INTERVAL)
```

### 6.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
–ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (error_handler):
‚îú‚îÄ‚îÄ Forbidden - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞
‚îú‚îÄ‚îÄ BadRequest - —É—Å—Ç–∞—Ä–µ–≤—à–∏–π callback
‚îú‚îÄ‚îÄ TimedOut - –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ tmpfiles.org
‚îî‚îÄ‚îÄ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫

–õ–æ–∫–∞–ª—å–Ω—ã–µ try-catch:
‚îú‚îÄ‚îÄ Database –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Flibusta
‚îî‚îÄ‚îÄ Telegram API –≤—ã–∑–æ–≤—ã
```

---

## üìä 7. –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –õ–û–ì–ò

### 7.1 –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```python
get_system_stats():
  ‚îú‚îÄ‚îÄ memory_used (MB)
  ‚îú‚îÄ‚îÄ memory_percent (%)
  ‚îú‚îÄ‚îÄ cpu_percent (%)
  ‚îú‚îÄ‚îÄ open_files (count)
  ‚îî‚îÄ‚îÄ threads (count)
```

### 7.2 –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è

```python
–¢–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π (Action):
‚îú‚îÄ‚îÄ "started bot"
‚îú‚îÄ‚îÄ "searched for books"
‚îú‚îÄ‚îÄ "searched for series"
‚îú‚îÄ‚îÄ "searched for authors"
‚îú‚îÄ‚îÄ "send file"
‚îú‚îÄ‚îÄ "viewed genres"
‚îú‚îÄ‚îÄ "set <setting> to <value>"
‚îú‚îÄ‚îÄ "payment_received"
‚îî‚îÄ‚îÄ "error sending book"
```

### 7.3 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

```
/logs/
  ‚îú‚îÄ‚îÄ app.log (—Ç–µ–∫—É—â–∏–π)
  ‚îú‚îÄ‚îÄ app.log.2025-01-15
  ‚îú‚îÄ‚îÄ app.log.2025-01-14
  ‚îî‚îÄ‚îÄ ... (60 –¥–Ω–µ–π —Ä–æ—Ç–∞—Ü–∏—è)

–§–æ—Ä–º–∞—Ç:
2025-01-15 14:30:45 - User 12345 (username) performed action: searched for books/—Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞; count:150
```

---

## üöÄ 8. PRODUCTION WORKFLOW

### 8.1 –¶–∏–∫–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```
1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
   ‚îú‚îÄ‚îÄ docker-compose.yml (—Å –ø–æ—Ä—Ç–æ–º 3306)
   ‚îú‚îÄ‚îÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   ‚îî‚îÄ‚îÄ –ö–æ–º–º–∏—Ç –≤ GitHub

2. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
   ‚îú‚îÄ‚îÄ git clone –∏–∑ master
   ‚îú‚îÄ‚îÄ docker build
   ‚îú‚îÄ‚îÄ docker push to Docker Hub
   ‚îî‚îÄ‚îÄ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

3. –î–µ–ø–ª–æ–π –Ω–∞ VPS
   ‚îú‚îÄ‚îÄ docker-compose pull
   ‚îú‚îÄ‚îÄ docker-compose up -d --force-recreate
   ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
   ‚îî‚îÄ‚îÄ docker system prune -f
```

### 8.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
docker-entrypoint-initdb.d/
  ‚îú‚îÄ‚îÄ zz_init_flibustabot.sql (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
  ‚îú‚îÄ‚îÄ zz_init_log_base.sql (–ª–æ–≥–∏)
  ‚îú‚îÄ‚îÄ lib*.sql (–∏–∑ –∞—Ä—Ö–∏–≤–æ–≤ .sql.gz)
  ‚îî‚îÄ‚îÄ init –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ volume –ø—É—Å—Ç–æ–π

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
1. –ü–æ–ª–æ–∂–∏—Ç—å –Ω–æ–≤—ã–µ .sql.gz –≤ db_init/sql/
2. deploy.sh -d (–ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
3. –û–∂–∏–¥–∞–Ω–∏–µ ~30 —Å–µ–∫—É–Ω–¥
```

### 8.3 –ë—ç–∫–∞–ø—ã

```python
–ê–¥–º–∏–Ω—Å–∫–∞—è –∫–æ–º–∞–Ω–¥–∞ - "üíæ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏":
‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ zip-–∞—Ä—Ö–∏–≤–æ–≤:
‚îÇ   ‚îú‚îÄ‚îÄ databases_backup_<date>.zip
‚îÇ   ‚îî‚îÄ‚îÄ logs_backup_<date>.zip
‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram
‚îî‚îÄ‚îÄ –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

–§–∞–π–ª—ã:
‚îú‚îÄ‚îÄ FlibustaSettings.sqlite
‚îú‚îÄ‚îÄ FlibustaLogs.sqlite
‚îî‚îÄ‚îÄ /logs/*.log*
```

---

## üß† 9. MEMORY BASE (–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞)

### 9.1 –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–í–µ—Ä—Å–∏—è**: Production (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –Ω–∞ 2025-01-15)  
**–°—Ç–∞—Ç—É—Å**: –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞ VPS  
**–ë–î**: MariaDB —Å –¥–∞–Ω–Ω—ã–º–∏ –§–ª–∏–±—É—Å—Ç—ã –æ—Ç 2025-10-25  

**–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –∫–Ω–∏–≥–∞–º/—Å–µ—Ä–∏—è–º/–∞–≤—Ç–æ—Ä–∞–º
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º (–∫–Ω–∏–≥ –∏ –∞–≤—Ç–æ—Ä–æ–≤)
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (—è–∑—ã–∫, —Ä–µ–π—Ç–∏–Ω–≥, —Ä–∞–∑–º–µ—Ä)
- ‚úÖ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–Ω–∏–≥–∏ –∏ –Ω–æ–≤–∏–Ω–∫–∏
- ‚úÖ –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã
- ‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- ‚úÖ –î–æ–Ω–∞—Ç—ã —á–µ—Ä–µ–∑ Telegram Stars

**–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ**:
- ‚ùå –ü–æ–∏—Å–∫ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º (–∞–≤—Ç–æ—Ä:, –Ω–∞–∑–≤–∞–Ω–∏–µ:)
- ‚ùå –ü–æ–∏—Å–∫ –ø–æ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É, –≥–æ—Ä–æ–¥—É, ISBN

### 9.2 –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

```python
1. –ú–µ–¥–ª–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
   –ü—Ä–∏—á–∏–Ω–∞: –ë–æ–ª—å—à–æ–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö, —Å–ª–∞–±—ã–π VPS
   –†–µ—à–µ–Ω–∏–µ: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL, –∏–Ω–¥–µ–∫—Å—ã

2. –õ–∏–º–∏—Ç 2000 –∫–Ω–∏–≥
   –ü—Ä–∏—á–∏–Ω–∞: –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏
   –°—Ç–∞—Ç—É—Å: –ü—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è —Ç–µ–∫—É—â–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

3. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–Ω–∏–≥–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
   –ü—Ä–∏—á–∏–Ω–∞: –¢—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞ —Å–∞–π—Ç–µ
   –†–µ—à–µ–Ω–∏–µ: –î–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ (—Å auth/–±–µ–∑ auth)
```

### 9.3 –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
2025-12-02: –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤–∏–Ω–∫–∏ –∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ (/pop)
2025-11-23: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —è–∑—ã–∫–∞—Ö
2025-11-15: –ü–æ–∏—Å–∫ –ø–æ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º –∫–Ω–∏–≥
2025-11-11: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ MariaDB
2025-11-09: –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ —Ä–æ–¥–Ω—É—é –ë–î –§–ª–∏–±—É—Å—Ç—ã
2025-10-14: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤
2025-10-01: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
2025-09-11: –ü–æ–∏—Å–∫ –ø–æ —Å–µ—Ä–∏—è–º
2025-09-06: –ö–æ–Ω—Ç–∞–∫—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
```

---

## üìö 10. KNOWLEDGE BASE

### 10.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

**–ü–æ—á–µ–º—É MariaDB –≤–º–µ—Å—Ç–æ SQLite?**
- –†–æ–¥–Ω–∞—è –ë–î –§–ª–∏–±—É—Å—Ç—ã (–ø—Ä—è–º–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (FULLTEXT –∏–Ω–¥–µ–∫—Å—ã)
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (–º–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø–∏—Å–µ–π)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å JOIN'–æ–≤

**–ü–æ—á–µ–º—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–∞?**
- Telegram –±–æ—Ç –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç "–ò—â—É –∫–Ω–∏–≥–∏..." —Å—Ä–∞–∑—É
- –ú–æ–∂–Ω–æ –Ω–∞–∂–∏–º–∞—Ç—å –¥—Ä—É–≥–∏–µ –∫–Ω–æ–ø–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

**–ü–æ—á–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ –ø–∞–º—è—Ç–∏?**
- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø–æ–∏—Å–∫–∞
- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 1 —á–∞—Å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å

**–ü–æ—á–µ–º—É SQLite –¥–ª—è –ª–æ–≥–æ–≤/–Ω–∞—Å—Ç—Ä–æ–µ–∫?**
- –õ—ë–≥–∫–æ—Å—Ç—å –∏ –ø—Ä–æ—Å—Ç–æ—Ç–∞
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- –ë—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –º–∞–ª—ã—Ö –æ–±—ä—ë–º–æ–≤

### 10.2 –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏ Best Practices

**Context Manager Pattern**:
```python
# –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
ContextManager.get(context, key, default)
ContextManager.set(context, key, value)
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–∏—á–Ω—ã–π —á–∞—Ç/–≥—Ä—É–ø–ø–∞
```

**Singleton –¥–ª—è –ª–æ–≥–≥–µ—Ä–∞**:
```python
class SingletonLogger:
    _instance = None
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
        return cls._instance
```

**–õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î**:
```python
@classmethod
def _init_db(cls):
    if cls._db_settings is None:
        cls._db_settings = DatabaseSettings()
```

**–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Å–∞**:
```python
_class_cached_langs = None  # –ö–µ—à –¥–ª—è –≤—Å–µ—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
```

**–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏**:
```python
asyncio.create_task(async_search_books(...))
# –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
```

### 10.3 SQL –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```sql
-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
SELECT * FROM (
    SELECT ... WHERE MATCH(...) AGAINST(...)
) as subquery
WHERE Lang = 'ru' AND LibRate >= 4

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
CREATE FULLTEXT INDEX libbook_fts ON libbook(FT)
CREATE INDEX IXUserLog ON UserLog(UserID, Timestamp)

-- ROW_NUMBER –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
ROW_NUMBER() OVER (PARTITION BY BookId ORDER BY BookId) AS rn
WHERE rn = 1
```

### 10.4 Telegram API –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

```python
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ vs –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
await query.edit_message_text(...)  # –î–ª—è callback
await message.reply_text(...)  # –î–ª—è –∫–æ–º–∞–Ω–¥

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö callback
except BadRequest as e:
    if "Query is too old" in str(e):
        return  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º

# –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã
if TimedOut:
    # –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ tmpfiles.org
    upload_to_tmpfiles(book_data, filename)
```

---

## üõ†Ô∏è 11. –ü–†–ò–ú–ï–†–´ –ö–û–î–ê

### 11.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è –ø–æ–∏—Å–∫–∞

```python
# 1. –î–æ–±–∞–≤–∏—Ç—å –≤ constants.py
SETTING_NEW_FILTER = 'new_filter'
SETTING_TITLES[SETTING_NEW_FILTER] = '–ù–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä'
SETTING_OPTIONS[SETTING_NEW_FILTER] = [
    ('value1', '–ó–Ω–∞—á–µ–Ω–∏–µ 1'),
    ('value2', '–ó–Ω–∞—á–µ–Ω–∏–µ 2')
]

# 2. –î–æ–±–∞–≤–∏—Ç—å –≤ UserSettingsType (database.py)
UserSettingsType = namedtuple('UserSettingsType',
    [..., 'NewFilter'])

# 3. –°–æ–∑–¥–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É –≤ –ë–î (db_init/zz_init_flibustabot.sql)
ALTER TABLE UserSettings ADD COLUMN NewFilter TEXT DEFAULT '';

# 4. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (handlers_settings.py)
async def handle_set_new_filter(query, context, action, params):
    user_params = get_user_params(context)
    current_value = user_params.NewFilter
    options = SETTING_OPTIONS[SETTING_NEW_FILTER]
    reply_markup = create_settings_keyboard(
        SETTING_NEW_FILTER, current_value, options
    )
    await edit_or_reply_message(query, SETTING_TITLES[SETTING_NEW_FILTER], reply_markup)

# 5. –î–æ–±–∞–≤–∏—Ç—å –≤ action_handlers (handlers_callback.py)
action_handlers = {
    ...
    f'set_{SETTING_NEW_FILTER}': handle_set_new_filter,
}

# 6. –î–æ–±–∞–≤–∏—Ç—å –≤ handle_set_actions (handlers_settings.py)
elif action.startswith(f'set_{SETTING_NEW_FILTER}_to_'):
    setting_type = SETTING_NEW_FILTER
    new_value = action.removeprefix(f'set_{SETTING_NEW_FILTER}_to_')
    update_user_params(context, NewFilter=new_value)

# 7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ SQL (database.py)
def build_sql_where_ft(lang, size_limit, rating_filter, new_filter):
    if new_filter:
        conditions.append(f"ColumnName = '{new_filter}'")
```

### 11.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

```python
# 1. –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (handlers_basic.py)
async def new_cmd(update: Update, context: CallbackContext):
    """–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã"""
    user = update.effective_user
    
    # –õ–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã
    text = "–†–µ–∑—É–ª—å—Ç–∞—Ç"
    
    await update.message.reply_text(text, parse_mode=ParseMode.HTML)
    logger.log_user_action(user, "used new command")

# 2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ main.py
application.add_handler(CommandHandler("new", new_cmd))

# 3. –î–æ–±–∞–≤–∏—Ç—å –≤ –º–µ–Ω—é (main.py)
commands = [
    ...
    BotCommand("new", "–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã"),
]
```

### 11.3 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

```python
# 1. –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (handlers_info.py)
async def handle_new_action(query, context, action, params):
    try:
        param = params[0]
        # –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        await query.message.reply_text(f"–†–µ–∑—É–ª—å—Ç–∞—Ç: {param}")
    except Exception as e:
        print(f"Error: {e}")
        await query.answer("‚ùå –û—à–∏–±–∫–∞")

# 2. –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ª–æ–≤–∞—Ä—å (handlers_callback.py)
action_handlers = {
    ...
    'new_action': handle_new_action,
}

# 3. –°–æ–∑–¥–∞—Ç—å –∫–Ω–æ–ø–∫—É (handlers_utils.py)
keyboard.append([InlineKeyboardButton(
    "–ù–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ",
    callback_data=f"new_action:{param}"
)])
```

---

## üîß 12. –†–ê–°–®–ò–†–ï–ù–ò–ï –ò –ú–û–î–ò–§–ò–ö–ê–¶–ò–Ø

### 12.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –ø–æ–∏—Å–∫–∞

```python
# 1. –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ (constants.py)
SETTING_SEARCH_AREA_NEW = 'new'

# 2. SQL –∑–∞–ø—Ä–æ—Å (database.py)
SQL_QUERY_NEW = f"""
SELECT {BASE_FIELDS}, ...
FROM new_table nt
JOIN libbook b ON b.BookID = nt.BookID
{BASE_JOINS}
WHERE MATCH(nt.SearchField) AGAINST(%s IN BOOLEAN MODE)
"""

SELECT_SQL_QUERY[SETTING_SEARCH_AREA_NEW] = SQL_QUERY_NEW

# 3. –î–æ–±–∞–≤–∏—Ç—å –≤ –æ–ø—Ü–∏–∏ (constants.py)
SETTING_OPTIONS[SETTING_SEARCH_AREA] = [
    ...
    (SETTING_SEARCH_AREA_NEW, '–ø–æ –Ω–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏'),
]

# 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø–æ–∏—Å–∫–µ (database.py)
def search_books(self, query, ..., search_area):
    sql_query_nested = SELECT_SQL_QUERY.get(search_area)
    ...
```

### 12.2 –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –æ—Ç—á—ë—Ç–∞

```python
# 1. –§—É–Ω–∫—Ü–∏—è –≤ DatabaseLogs (database.py)
def get_new_report(self, days=30):
    with self.connect() as conn:
        cursor = conn.cursor()
        cursor.execute("""
            SELECT ... FROM UserLog
            WHERE Timestamp >= date('now', ?)
            GROUP BY ...
        """, (f'-{days} days',))
        return cursor.fetchall()

# 2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ (admin.py)
async def admin_new_report(update: Update, context: CallbackContext):
    if not is_admin(update.effective_user.id):
        return
    
    data = DB_LOGS.get_new_report(30)
    text = "üìä <b>–ù–æ–≤—ã–π –æ—Ç—á—ë—Ç</b>\n\n"
    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...
    
    await update.message.reply_text(text, parse_mode=ParseMode.HTML)

# 3. –ö–Ω–æ–ø–∫–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (admin.py)
ADMIN_BUTTONS = {
    ...
    "admin_new_report": "üìä –ù–æ–≤—ã–π –æ—Ç—á—ë—Ç",
}
```

### 12.3 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º API

```python
# 1. –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç (new_api_client.py)
class NewAPIClient:
    def __init__(self, api_key):
        self._api_key = api_key
        self._session = None
    
    async def fetch_data(self, params):
        async with aiohttp.ClientSession() as session:
            async with session.get(url, params=params) as response:
                return await response.json()

# 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ
new_client = NewAPIClient(os.getenv('API_KEY'))

async def handle_api_request(update, context):
    result = await new_client.fetch_data({'q': query})
    await update.message.reply_text(str(result))
```

---

## üìñ 13. FAQ –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–û–í

**Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç –∫–Ω–∏–≥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ?**  
A: –ò–∑–º–µ–Ω–∏—Ç–µ `MAX_BOOKS_SEARCH` –≤ `constants.py` –∏ –æ–ø—Ü–∏–∏ –≤ `SETTING_OPTIONS[SETTING_MAX_BOOKS]`

**Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è?**  
A: –î–æ–±–∞–≤—å—Ç–µ –≤ `SETTING_OPTIONS[SETTING_BOOK_FORMAT]` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Flibusta –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç

**Q: –ü–æ—á–µ–º—É –ø–æ–∏—Å–∫ –º–µ–¥–ª–µ–Ω–Ω—ã–π?**  
A: MariaDB –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø–∏—Å–µ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã (—è–∑—ã–∫, —Ä–µ–π—Ç–∏–Ω–≥) –¥–ª—è —Å—É–∂–µ–Ω–∏—è –≤—ã–±–æ—Ä–∫–∏

**Q: –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –§–ª–∏–±—É—Å—Ç—ã?**  
A: –ü–æ–ª–æ–∂–∏—Ç–µ –Ω–æ–≤—ã–µ .sql.gz —Ñ–∞–π–ª—ã –≤ `db_init/sql/` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `deploy.sh -d`

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PostgreSQL?**  
A: –î–∞, –Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã (—Å–∏–Ω—Ç–∞–∫—Å–∏—Å FULLTEXT –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è)

**Q: –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤?**  
A: –ù—É–∂–µ–Ω Redis –¥–ª—è shared state, load balancer –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, shared volume –¥–ª—è –ë–î

**Q: –ü–æ—á–µ–º—É SQLite –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫, –∞ –Ω–µ MariaDB?**  
A: –ü—Ä–æ—Å—Ç–æ—Ç–∞, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î

**Q: –ö–∞–∫ –æ—Ç–ª–∞–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –ø–∞–º—è—Ç—å—é?**  
A: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `get_memory_usage()` –∏–∑ `health.py` –∏ –ª–æ–≥–∏ Docker: `docker stats`

---

## üéØ 14. –ò–ù–°–¢–†–£–ö–¶–ò–ò –î–õ–Ø –ò–ò-–ê–°–°–ò–°–¢–ï–ù–¢–û–í

### 14.1 –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–¥–æ–º —É—á–∏—Ç—ã–≤–∞–π—Ç–µ

```python
‚úÖ –í–°–ï–ì–î–ê:
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å is_admin() –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å get_user_params() –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ logger.log_user_action()
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è (try-except)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ParseMode.HTML –¥–ª—è —Ä–∞–∑–º–µ—Ç–∫–∏
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- –î–æ–±–∞–≤–ª—è—Ç—å type hints –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π

‚ùå –ù–ò–ö–û–ì–î–ê:
- –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–æ–ª–≥–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- –ù–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å constants.py)
- –ù–µ –∏–∑–º–µ–Ω—è—Ç—å —Å—Ö–µ–º—É –ë–î –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å context.user_data –Ω–∞–ø—Ä—è–º—É—é (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ ContextManager)
- –ù–µ –∑–∞–±—ã–≤–∞—Ç—å await –¥–ª—è async —Ñ—É–Ω–∫—Ü–∏–π
- –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å timeout –æ—à–∏–±–∫–∏
```

### 14.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–º–∏—Ç–æ–≤

```
feat: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É
fix: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–Ω–∏–≥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
refactor: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω SQL –∑–∞–ø—Ä–æ—Å –ø–æ–∏—Å–∫–∞
docs: –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
perf: –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
```

### 14.3 –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
‚ñ° –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ constants.py
‚ñ° –î–æ–±–∞–≤–ª–µ–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã SQL –∑–∞–ø—Ä–æ—Å—ã –≤ database.py
‚ñ° –°–æ–∑–¥–∞–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤ handlers_*.py
‚ñ° –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ main.py
‚ñ° –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚ñ° –û–±—Ä–∞–±–æ—Ç–∞–Ω—ã –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚ñ° –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ
‚ñ° –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚ñ° –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–æ—Å—Ç—å –≤ bot_news.py (–µ—Å–ª–∏ user-facing)
‚ñ° –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–∞—Ö (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
```

### 14.4 Debugging –ø–æ–¥—Å–∫–∞–∑–∫–∏

```python
# –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ø—Ä–∏–Ω—Ç—ã
print(f"DEBUG: {variable}")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
print(f"DEBUG: context.user_data = {context.user_data}")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQL
print(f"DEBUG: sql_query = {sql_query}")
print(f"DEBUG: params = {params}")

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–º—è—Ç—å
from health import get_memory_usage
print(f"Memory: {get_memory_usage():.1f}MB")

# –õ–æ–≥–∏ Docker
docker-compose logs -f bot
docker-compose logs -f db
```

---

## üìû 15. –ö–û–ù–¢–ê–ö–¢–´ –ò –†–ï–°–£–†–°–´

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: https://github.com/holyshithappens/flibusta_bot_mariadb  
**Docker Hub**: holyshithappens/flbst-bot-mdb  
**Email**: holyshithappens@proton.me  
**Telegram**: @FlibustaBotNews  

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫**:
- python-telegram-bot: https://docs.python-telegram-bot.org/
- MariaDB: https://mariadb.com/kb/en/documentation/
- aiohttp: https://docs.aiohttp.org/

---

## üîÆ 16. ROADMAP –ò –ë–£–î–£–©–ò–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 16.1 –ë–ª–∏–∂–∞–π—à–∏–µ –ø–ª–∞–Ω—ã
- [ ] –í–µ—Ä–Ω—É—Ç—å –ø–æ–∏—Å–∫ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º (–∞–≤—Ç–æ—Ä:, –Ω–∞–∑–≤–∞–Ω–∏–µ:)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ë–î –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã (–∏–Ω–¥–µ–∫—Å—ã)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –£–ª—É—á—à–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ –≥—Ä—É–ø–ø–∞—Ö (–ø—Ä–∞–≤–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)

### 16.2 –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ü–µ–ª–∏
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –±–æ–ª–µ–µ –º–æ—â–Ω—ã–π VPS
- [ ] Redis –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∫–µ—à–∞
- [ ] Elasticsearch –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –ø–æ–∏—Å–∫–∞
- [ ] Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] API –¥–ª—è —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É–¥–∏–æ–∫–Ω–∏–≥

### 16.3 –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∏–¥–µ–∏
- [ ] AI —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–Ω–∏–≥
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —á–∏—Ç–∞–ª–∫–∞–º–∏
- [ ] –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Å–ø–∏—Å–∫–∏ —á—Ç–µ–Ω–∏—è, –æ–±–∑–æ—Ä—ã)
- [ ] –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è (–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, —Ä–µ–π—Ç–∏–Ω–≥–∏)

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–≠—Ç–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è:
- ‚úÖ –ü–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –û—Ç–ª–∞–¥–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫
- ‚úÖ –û–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚úÖ –†–∞–±–æ—Ç—ã —Å –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏ (–≤–∫–ª—é—á–∞—è –º–µ–Ω—è!)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**:
1. –î–µ—Ä–∂–∏—Ç–µ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
2. –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ Knowledge Base
3. –û–±–Ω–æ–≤–ª—è–π—Ç–µ Roadmap –ø–æ –º–µ—Ä–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

**–î–ª—è –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤**: –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç - –≤–∞—à –≥–ª–∞–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–¥–æ–º –≤—Å–µ–≥–¥–∞ —Å—Å—ã–ª–∞–π—Ç–µ—Å—å –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.